<!DOCTYPE HTML>
<html lang="ko">
<head>
    <%- include('head') %>
    <title>마이페이지</title>
    <link type = "text/css" rel="stylesheet" href="/public/css/mypage.css">
    <link type = "text/css" rel="stylesheet" href="/public/css/user_update.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<body>
    <!-- header -->
    <%- include('header') %>
  
    <div class="mypage" style="display: inline;">

        <!-- 마이페이지 로고 -->
        <div class="logo"> 마이페이지 </div>
        
        <div class ="align">

        <!-- 왼쪽 메뉴 -->
        <div class="myPageLeftMenu fL">
            <div class="myPageSubMenu">
                <div class="order">
                    주문 내역
                </div>
                <div class="like">
                    찜한 상품
                </div>
                <div class="user">
                    개인 정보
                </div>
            </div>
        </div>
        <br>
        <div class="mobilemenu">
            <div class="order">
                주문내역
            </div>
            <div class="like">
                찜한 상품
            </div>
            <div class="user" >
                개인 정보
            </div>
        </div>
        <br>

        <!-- 오른 쪽 메뉴 -->
        <!-- 정보 수정 -->
        <div id="user_update">
            <!-- 사용자 정보 수정-->
            <div id="user-update">
                <!-- 어느 페이지인지 설명 -->
                <div class="div-sub">
                    <div style="float:left; font-weight: bold; font-size: 20px;">개인 정보</div>
                    <div style="float:right; font-size: 10pt; margin: 0;"><img src="/public/images/home.png" class="mypage-home-image"> 메뉴  >  마이페이지  >  개인 정보</div>
                    <div style="width:100%; height: 2px; background: #000000; display:inline-block; margin: 0;"> </div>
                </div>

                <!-- 정보 수정 폼 -->
                <div class="div-align" style="margin-top: 100x; margin-bottom: 50px;">
                    <div class="div-agree">
                        <!-- 정보 입력 -->
                        <% for (var user of user) { %>
                        <div class="text"># ID</div><input type="text" class="inputValue" name="id" value="<%= user.m_id %>" readonly/><br>
                        <div class="text"># PASSWORD</div><input type="password" class="inputValue" name="pw" value="" placeholder="비밀번호"/> <br>
                        <div class="text"># NAME</div><input type="text" class="inputValue" name="username" value="<%= user.m_name %>"/> <br>
                        <div class="text"># TEL</div><input type="tel" class="inputValue" name="tel" value="<%= user.m_tel %>"/> <br>
                        <div class="text"># ADDRESS</div><input type="text" class="inputValue" name="addr" value="<%= user.m_addr %>"/> <br>
                        <% } %>
                        <!-- 경고 메시지 -->
                        <p id="p-warning">* 아이디는 수정할 수 없습니다.</p>

                        <!-- 정보 수정 버튼  -->
                        <button id="btn_update" type="button" style="margin: 30px 0;">정보 수정</button>
                    </div>
                </div>
            </div>
            <!-- 사용자 정보 수정 -->
</div>
    </div>
</body>

<script> 
// 왼쪽 메뉴에 따른 페이지 전환
$(".order").click(function(){
    location.href = '/order_list';
});
$(".like").click(function(){
    location.href = '/like_list';
});
$(".user").click(function(){
    location.href ='/user_update';
});

//개인 정보 수정 
$("#btn_update").click(function () {
    var id = $('input[name=id]').val();
    var pw = $('input[name=pw]').val();
    var name = $('input[name=username]').val();
    var tel = $('input[name=tel]').val();
    var addr = $('input[name=addr]').val();
    if (id == "" || pw == "" || name == "" || tel == "" || addr == "" ) {
        jQuery('#p-warning').text('입력칸을 모두 채워주세요.');
        jQuery('#p-warning').css("display", "block");
    } else {
        // 한 번에 중복 클릭 방지
        $("#btn_update").attr("disabled", true);
        var data = { "id": id, "pw": pw, "name": name, "tel": tel, "addr" : addr };
        // 개인 정보 수정 데이터 전송
        $.ajax({
            type: 'post',
            url: '/user_updateDone',
            datatype: 'json',
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            data: data
        })
        .success(function (data) {
            if (data.result == 1) {
                alert("회원 정보가 수정되었습니다.");
            } else {
                $("#btn_update").attr("disabled", false);
                jQuery('#p-warning').text("정보 수정 실패");
                jQuery('#p-warning').css("display", "block");
            }
        })
    }
});
</script>
</html>
