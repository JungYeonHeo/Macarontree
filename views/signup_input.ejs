<!DOCTYPE HTML>
<html lang="ko">
<head>
    <%- include('head') %>
    <title>정보입력</title>
    <link type = "text/css" rel="stylesheet" href="/public/css/signup_input.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<body>
    <!-- header -->
    <%- include('header') %>
  
    <!-- 회원가입 절차 설명 -->
    <div class="menu">
        <div class="menu-bg">
                <div style="width: 28%;float: left;">
                    <p class="signtxt">회원가입</p>
                </div>
                <div style="width: 80%;">
                    <p class="sign_num">
                        <label class="menu-txt">1. 약관동의 > </label>
                        <label class="point">2.</label>
                        <label class="point2"> 정보입력</label>
                        <label class="menu-txt"> > 3. 가입완료</label> 
                    </p>
                </div>
        </div>
    </div>
        
    <!-- 정보 입력 폼 -->
    <div class="div-align">
        <div class="div-agree">
            <!-- 정보 입력 -->
            <input type="text" class="inputValue" name="id" autofocus required placeholder="아이디"/><br>
            <input type="password" class="inputValue" name="pw" autofocus required placeholder="비밀번호"/> <br>
            <input type="text" class="inputValue" name="username" autofocus required placeholder="이름"/> <br>
            <input type="tel" class="inputValue" name="tel" autofocus required placeholder="전화번호"/> <br>
            <input type="text" class="inputValue" name="addr" autofocus required placeholder="주소"/> <br>

            <!-- 경고 메시지 -->
            <p id="p-warning"></p>

            <!-- 회원가입 버튼  -->
            <button id="btn_signup" type="button" style="margin: 30px 0;">회원가입</button>
        </div>
    </div>
</body>

<script>
  $("#btn_signup").click(function () {
    var id = $('input[name=id]').val();
    var pw = $('input[name=pw]').val();
    var name = $('input[name=username]').val();
    var tel = $('input[name=tel]').val();
    var addr = $('input[name=addr]').val();
    if (id == "" || pw == "" || name == "" || tel == "" || addr == "" ) {
      jQuery('#p-warning').text('입력칸을 모두 채워주세요.');
      jQuery('#p-warning').css("display", "block");
    } else {
      // 한 번에 중복 클릭 방지
      $("#btn_signup").attr("disabled", true);
      data ={"id": id};
      // 아이디 중복 확인
      $.ajax({
        type: 'post',
        url: '/id_check',
        datatype: 'json',
        contentType: "application/x-www-form-urlencoded; charset=utf-8",
        data: data
      })
      .success(function (data) {
        $("#btn_signup").attr("disabled", false);
        if (data.result == 2) {
            var data = { "id": id, "pw": pw, "name": name, "tel": tel, "addr" : addr };
            $.ajax({
              type: 'post',
              url: '/signup_add',
              datatype: 'json',
              contentType: "application/x-www-form-urlencoded; charset=utf-8",
              data: data
            })
            .success(function (data) {
              $("#btn_signup").attr("disabled", false);
              if (data.result == 4) { 
                //회원가입 성공, 로그인으로 이동
                jQuery('#p-warning').css("display", "none");
                alert("회원가입 성공");
                location.href ='/login';
              } else {
                jQuery('#p-warning').text(data.msg);
                jQuery('#p-warning').css("display", "block");
              }

            });
        } else {
          // id 중복으로 인한 경고 메시지 출력
          jQuery('#p-warning').text("아이디가 중복됩니다.");
          jQuery('#p-warning').css("display", "block");
        }

      });

    }
  });
</script>
</html>
